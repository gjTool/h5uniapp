(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/download/download"],{"10db":function(t,e,n){},"3ff3":function(t,e,n){"use strict";(function(t){n("c9d0"),n("921b");o(n("66fd"));var e=o(n("d771"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("6e42")["createPage"])},"97cf":function(t,e,n){"use strict";(function(t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,s=r(n("a34a")),i=r(n("4e99"));function r(t){return t&&t.__esModule?t:{default:t}}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e,n,o,a,s,i){try{var r=t[s](i),c=r.value}catch(l){return void n(l)}r.done?e(c):Promise.resolve(c).then(o,a)}function u(t){return function(){var e=this,n=arguments;return new Promise(function(o,a){var s=t.apply(e,n);function i(t){l(s,o,a,i,r,"next",t)}function r(t){l(s,o,a,i,r,"throw",t)}i(void 0)})}}var d,f=function(){return n.e("components/mix-loading/mix-loading").then(n.bind(null,"7978"))},h=function(){return n.e("components/uni-icons/uni-icons").then(n.bind(null,"9e2c"))},g=function(){return n.e("components/uni-nav-bar/uni-nav-bar").then(n.bind(null,"b7c2"))},p=function(){return n.e("components/uni-popup/uni-popup").then(n.bind(null,"133f"))},w=0,b=!1,m=(a={components:{mixLoading:f,uniIcons:h,uniNavBar:g,uniPopup:p},data:function(){return{tabBars:[{name:"小说",id:"2",contentList:[]},{name:"影视",id:"3",contentList:[]},{name:"漫画",id:"1",contentList:[]}],tabCurrentIndex:0,scrollLeft:0,enableScroll:!0,contentData:{},loading:!1,keyWord:"",timedown:3,loadListRequest:null,cancelFlag:!1,show:!1,type:"",selectObj:"",selectObjIndex:0}},onHide:function(){this.$refs["share"].close(),this.cancelFlag=!1},onShow:function(){t.request({url:"https://www.gjtool.cn/download/config.json",method:"GET",complete:function(e){if(200==e.statusCode&&e.data){var n=e.data;t.setStorage({key:"config",data:n}),n&&n.enable||t.reLaunch({url:"/pages/gonggao/gonggao"})}}})},computed:{}},c(a,"onShow",function(){plus.navigator.setFullscreen(!1),this.loadList(),t.request({url:"https://www.gjtool.cn/download/config.json",method:"GET",complete:function(e){if(200==e.statusCode&&e.data){var n=e.data;n&&n.enable||t.navigateTo({url:"/pages/gonggao/gonggao"})}}})}),c(a,"onLoad",function(){var e=u(s.default.mark(function e(){var n;return s.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=this,w=t.getSystemInfoSync().windowWidth,this.$eventHub.$on("xsDownload",function(e){var o=t.getStorageSync("xsDownload");if(o){for(var a=0;a<o.length;a++)if(o[a].name==e.name){o[a].cache=!0,o[a].download="2",n.downloadxsAll(o[a]);break}n.tabBars[0].contentList=o,t.setStorageSync("xsDownload",o)}}),this.$eventHub.$on("ysDownload",function(t){}),this.$eventHub.$on("mhDownload",function(t){}),setTimeout(function(){for(var e=n.tabBars[0].contentList,o=0;o<e.length;o++)"1"!=e[o].download&&(e[o].download="3");n.tabBars[0].contentList=e,t.setStorageSync("xsDownload",e)},300);case 6:case"end":return e.stop()}},e,this)}));function n(){return e.apply(this,arguments)}return n}()),c(a,"onUnload",function(){for(var e=_this.tabBars[0].contentList,n=0;n<e.length;n++)e[n].download="3";_this.tabBars[0].contentList=e,t.setStorageSync("xsDownload",e)}),c(a,"onReady",function(){}),c(a,"methods",{downloadxsAll:function(t){if(t.cache){t.xslist,t.data;this.getData(0,t)}},isDownload:function(t,e){for(var n=!1,o=0;o<e.length;o++)if(e[o].num==t&&(e[o].list.length||"done"==e[o].state)){n=!0;break}return n},getNoDownload:function(t,e){return this.isDownload(t,e)?(t++,this.getNoDownload(t,e)):t},getData:function(e,n){var a=this,s=t.getStorageSync("xsDownload");if(s)for(var r=0;r<s.length;r++)if(s[r].name==n.name){n=s[r];break}var c=this.getNoDownload(e,n.data);if(e=c,e>=n.xslist.length){for(var l=a.tabBars[0].contentList,u=0;u<l.length;u++)l[u].name==n.name&&(l[u].download="1");return a.tabBars[0].contentList=l,t.setStorageSync("xsDownload",l),void(a.selectObj.downloadText="继续")}"3"!=n.download&&t.request({url:i.default.baseUrl,data:{xsurl2:n.xslist[e].url},method:"GET",complete:function(t){if(200==t.statusCode&&t.data&&0==t.data.code){var s=t.data.content;console.log(o("加载成功：第"+e+"章"," at pages/download/download.vue:300")),a.setCacheValue(e,s,"done",n,function(){e++,a.getData(e,n)})}else console.log(o("加载失败：第"+e+"章"," at pages/download/download.vue:306")),a.setCacheValue(e,[],"fail",n,function(){a.getData(e,n)})}})},setCacheValue:function(e,n,o,a,s){var i=this,r=a.xslist;e=parseInt(e);var c={name:a.name,cover:a.cover,url:a.url,num:a.num,cache:!1,download:"0",xslist:r,data:[]};e>=r.length-1?c.download="1":c.download="2";var l={numName:r[e].num,numUrl:r[e].url,num:e,list:n,state:o};c.data.push(l);var u=t.getStorageSync("xsDownload"),d=!1;if(u){for(var f=0;f<u.length;f++)if(u[f].name==a.name){var h=u[f].data;u[f].cover=a.cover,u[f].url=a.url,u[f].num=a.num;for(var g=!1,p=0;p<h.length;p++)h[p].numName==r[e].num&&h[p].num==e&&(h[p].list=n,h[p].numUrl=r[e].url,h[p].state="done",g=!0);g||(u[f].xslist=r,u[f].data.push(l)),d=!0;break}d||u.push(c)}else u=[],u.push(c);i.tabBars[0].contentList=u,t.setStorageSync("xsDownload",u),s&&s()},gotoXsJianjie:function(){var e=this.selectObj;if("3"==this.selectType&&t.navigateTo({url:"/pages/details/details?data=".concat(JSON.stringify(e))}),"1"==this.selectType&&t.navigateTo({url:"/pages/details/mhdetails?data=".concat(JSON.stringify(e))}),"2"==this.selectType){var n={cover:e.cover,name:e.name,num:e.num,url:e.url};t.navigateTo({url:"/pages/details/xsdetails?data=".concat(JSON.stringify(n))})}},gotoXsMulu:function(){var e=this.selectObj;this.selectType,this.selectType,"2"==this.selectType&&t.navigateTo({url:"/pages/xslist/xslist?xsname="+encodeURIComponent(e.name)+"&num="+encodeURIComponent(e.num)+"&from=download&url="+e.url+"&cover="+e.cover})},downloadXs:function(){var e=this,n=this.selectObj;if(this.$refs["share"].close(),this.selectType,this.selectType,"2"==this.selectType){var o=t.getStorageSync("xsDownload"),a={};if(o){for(var s=0;s<o.length;s++)if(o[s].name==n.name){o[s].cache=!0,"2"!=o[s].download?(o[s].download="2",a=o[s],e.selectObj.downloadText="暂停"):(o[s].download="3",e.selectObj.downloadText="继续");break}e.tabBars[0].contentList=o,t.setStorageSync("xsDownload",o),a&&a.download&&"2"==a.download&&e.downloadxsAll(a)}}},deleteXsSc:function(){var e=this,n=this;this.$refs["share"].close();var o=this.selectObj;t.showModal({title:"提示",content:"确定删除《"+o.name+"》吗？",success:function(a){if(a.confirm){if(e.selectType,e.selectType,"2"==e.selectType){var s=t.getStorageSync("xsDownload"),i=!1;if(s){for(var r=0;r<s.length;r++)if(s[r].name==o.name){i=!0,s[r].cache=!1;break}n.tabBars[0].contentList=s,t.setStorageSync("xsDownload",s)}setTimeout(function(){i?t.showToast({title:"删除成功"}):t.showToast({title:"删除失败",icon:"none"})},100)}}else a.cancel}})},longpress:function(t,e,n){this.selectObj=t,this.selectObjIndex=e,"3"==t.download||"1"==t.download?this.selectObj.downloadText="继续":this.selectObj.downloadText="暂停",this.cancelFlag=!1,this.selectType=n,"2"==this.selectType&&this.togglePopup("bottom","share")},togglePopup:function(t,e){switch(t){case"top":this.content="顶部弹出 popup";break;case"bottom":this.content="底部弹出 popup";break;case"center":this.content="居中弹出 popup";break}this.type=t,"tip"===e?this.show=!0:this.$refs[e].open()},cancel:function(t){"tip"!==t?this.$refs[t].close():this.show=!1},change:function(t){console.log(o(t.show," at pages/download/download.vue:557"))},loadList:function(){var e=this;t.getStorage({key:"xsDownload",success:function(t){console.log(o(t.data," at pages/download/download.vue:564")),e.tabBars[0].contentList=t.data}}),t.getStorage({key:"ysDownload",success:function(t){e.tabBars[1].contentList=t.data}}),t.getStorage({key:"mhDownload",success:function(t){e.tabBars[2].contentList=t.data}})},getPercent:function(t){var e=t.data.length,n=t.xslist.length;return(e/n*100).toFixed(2)},getDownloadState:function(t){var e="";switch(t){case"1":e="下载完毕";break;case"2":e="正在下载";break;case"3":default:e="下载暂停";break}return e},imgError:function(t){t.cover="/static/movie.png"},setEnableScroll:function(t){this.enableScroll!==t&&(this.enableScroll=t)},changeTab:function(){var t=u(s.default.mark(function t(e){var n,o,a,i,r,c=this;return s.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.loading=!1,b&&(clearTimeout(b),b=!1),n=e,"object"===typeof e&&(n=e.detail.current),"object"===typeof d){t.next=8;break}return t.next=7,this.getElSize("nav-bar");case 7:d=t.sent;case 8:d.scrollLeft,o=0,a=0,i=0;case 12:if(!(i<=n)){t.next=21;break}return t.next=15,this.getElSize("tab"+i);case 15:r=t.sent,o+=r.width,i===n&&(a=r.width);case 18:i++,t.next=12;break;case 21:"number"===typeof e&&(this.tabCurrentIndex=n),b=setTimeout(function(){c.scrollLeft=o-a/2>w/2?o-a/2-w/2:0,"object"===typeof e&&(c.tabCurrentIndex=n),c.tabCurrentIndex=n;c.tabBars[c.tabCurrentIndex]},300);case 23:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),getElSize:function(e){return new Promise(function(n,o){var a=t.createSelectorQuery().select("#"+e);a.fields({size:!0,scrollOffset:!0,rect:!0},function(t){n(t)}).exec()})}}),a);e.default=m}).call(this,n("6e42")["default"],n("0de9")["default"])},bc4f:function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=(t._self._c,t.__map(t.tabBars,function(e,n){var o=t.__map(e.contentList,function(e,n){var o=t.getDownloadState(e.download),a=t.getPercent(e);return{$orig:t.__get_orig(e),m0:o,m1:a}});return{$orig:t.__get_orig(e),l0:o}}));t.$mp.data=Object.assign({},{$root:{l1:n}})},a=[];n.d(e,"a",function(){return o}),n.d(e,"b",function(){return a})},d771:function(t,e,n){"use strict";n.r(e);var o=n("bc4f"),a=n("e437");for(var s in a)"default"!==s&&function(t){n.d(e,t,function(){return a[t]})}(s);n("f073");var i=n("2877"),r=Object(i["a"])(a["default"],o["a"],o["b"],!1,null,null,null);e["default"]=r.exports},e437:function(t,e,n){"use strict";n.r(e);var o=n("97cf"),a=n.n(o);for(var s in o)"default"!==s&&function(t){n.d(e,t,function(){return o[t]})}(s);e["default"]=a.a},f073:function(t,e,n){"use strict";var o=n("10db"),a=n.n(o);a.a}},[["3ff3","common/runtime","common/vendor"]]]);