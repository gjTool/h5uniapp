(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/xs/xs"],{5835:function(t,e,n){"use strict";n.r(e);var a=n("5bee"),o=n.n(a);for(var i in a)"default"!==i&&function(t){n.d(e,t,function(){return a[t]})}(i);e["default"]=o.a},"5bee":function(t,e,n){"use strict";(function(t,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(n("4e99"));function i(t){return t&&t.__esModule?t:{default:t}}var s=function(){return n.e("components/mix-loading/mix-loading").then(n.bind(null,"7978"))},l=function(){return n.e("components/uni-icons/uni-icons").then(n.bind(null,"9e2c"))},r=function(){return n.e("components/uni-nav-bar/uni-nav-bar").then(n.bind(null,"b7c2"))},u=function(){return Promise.all([n.e("common/vendor"),n.e("components/battery/battery")]).then(n.bind(null,"3d9f"))},c={components:{mixLoading:s,uniIcons:l,uniNavBar:r,battery:u},data:function(){return{black:!1,num:0,xsname:"",show:!1,visible:!1,loading:!0,title:"",url:"",url1:"",xslist:[],list:[],scrollTop:0,prevTimer:null,nextTimer:null,xsurl2Request:null,scrollTimer:null,scrollTopTotal:0,style:{pageHeight:0,contentViewHeight:0,footViewHeight:0,mitemHeight:0},UIDevice:null,battery:{},level:100,time:"00:00",getBatteryTimer:null,load5limitCache:!0,flag:0,text:"",lastX:0,lastY:0,ditance:120,cover:""}},computed:{itemshow:function(){return!!(this.list&&this.list.length>0)}},created:function(){var e=t.getSystemInfoSync();this.style.pageHeight=e.windowHeight,this.style.contentViewHeight=e.windowHeight-e.screenWidth/750*100-70},methods:{prev:function(){var e=this,n=this;n.num<=0?t.showToast({title:"已经是第一章了",icon:"none"}):(clearTimeout(this.prevTimer),this.prevTimer=setTimeout(function(){e.num--,n.num<=-1&&(n.num=0),e.reloadContent()},300))},next:function(){var e=this,n=this;n.num>=this.xslist.length-1?t.showToast({title:"已经是最后一章了",icon:"none"}):(clearTimeout(this.nextTimer),this.xsurl2Request&&this.xsurl2Request.abort(),this.nextTimer=setTimeout(function(){n.num++,n.num>=e.xslist.length&&(n.num=e.xslist.length-1),e.reloadContent()},300))},reloadContent:function(){var e=this,n=this,a=this.num;a=parseInt(a),t.setStorage({key:"xsNum"+n.xsname,data:a});try{var i=t.getStorageSync("xsShouCang");if(i){for(var s=0;s<i.length;s++)if(i[s].name==n.xsname){i[s].num=a,!0;break}t.setStorage({key:"xsShouCang",data:i})}}catch(m){}if(this.xslist.length){var l=this.xslist;n.title=l[a].num,n.list=[];var r=t.getStorageSync("xsDownload"),u=!1;if(r)for(var c=0;c<r.length;c++)if(r[c].name==n.xsname){for(var h=r[c].data,d=0;d<h.length;d++)if((h[d].num||0==h[d].num)&&h[d].num==a&&h[d].list.length){n.list=h[d].list,setTimeout(function(){t.pageScrollTo({scrollTop:0,duration:0})},0),u=!0;break}break}if(u)return n.loading=!1,void setTimeout(function(){e.getScrollTopTotal(),e.load5limit()},300);n.loading=!0,n.setCacheValue(a,[],"loading"),n.xsurl2Request=t.request({url:o.default.baseUrl,data:{xsurl2:l[a].url},method:"GET",complete:function(o){200==o.statusCode&&o.data&&0==o.data.code?(n.list=o.data.content,n.setCacheValue(a,n.list,"done"),setTimeout(function(){e.getScrollTopTotal(),e.load5limit()},300)):(setTimeout(function(){e.getScrollTopTotal()},300),n.setCacheValue(a,[],"fail"),t.showToast({title:"获取第"+a+"章内容失败",icon:"none"})),n.loading=!1}})}},load5limit:function(){if(this.load5limitCache){var t=this.num;t=parseInt(t);this.xslist;this.loadCache(t+1),this.loadCache(t+2),this.loadCache(t+3),this.loadCache(t+4),this.loadCache(t+5)}},loadCache:function(e){var n=this.xslist;if(!(e>=n.length)){var a=this,o=t.getStorageSync("xsDownload");a.xslist;e=parseInt(e);var i=!1;if(o)for(var s=0;s<o.length;s++)if(o[s].name==a.xsname){for(var l=o[s].data,r=0;r<l.length;r++)if(l[r].num&&l[r].num==e&&(l[r].list.length||"loading"==l[r].state||"done"==l[r].state)){i=!0;break}break}i||(a.setCacheValue(e,[],"loading"),a.getData(e))}},getData:function(e){var n=this,i=this.xslist;e=parseInt(e);var s=i[e].url;t.request({url:o.default.baseUrl,data:{xsurl2:s},method:"GET",complete:function(t){if(200==t.statusCode&&t.data&&0==t.data.code){var o=t.data.content;console.log(a("加载成功：第"+e+"章"," at pages/xs/xs.vue:309")),n.setCacheValue(e,o,"done")}else console.log(a("加载失败：第"+e+"章"," at pages/xs/xs.vue:312")),n.setCacheValue(e,[],"fail")}})},setCacheValue:function(e,n,o){var i=this,s=this.xslist;e=parseInt(e),console.log(a(i.cover," at pages/xs/xs.vue:323"));var l={name:i.xsname,cover:i.cover,url:this.url1,num:this.num,cache:!1,download:"0",xslist:s,data:[]},r={numName:s[e].num,numUrl:s[e].url,num:e,list:n,state:o};l.data.push(r);var u=t.getStorageSync("xsDownload"),c=!1;if(u){for(var h=0;h<u.length;h++)if(u[h].name==i.xsname){var d=u[h].data;u[h].cover=i.cover,u[h].url=i.url1,u[h].num=i.num;for(var m=!1,g=0;g<d.length;g++)d[g].numName==s[e].num&&d[g].num==e&&(d[g].list=n,d[g].numUrl=s[e].url,d[g].state="done",m=!0);m||(u[h].xslist=s,u[h].data.push(r)),c=!0;break}c||u.push(l)}else u=[],u.push(l);t.setStorageSync("xsDownload",u)},download:function(){var e=t.getStorageSync("xsDownload");if(e){for(var n=0;n<e.length;n++)if(e[n].name==this.xsname){e[n].cache?t.showToast({title:"已经加入下载了",icon:"none"}):(e[n].cache=!0,e[n].download="2",t.showToast({title:"加入下载成功"})),this.$eventHub.$emit("xsDownload",e[n]);break}t.setStorageSync("xsDownload",e)}},changeBg:function(){this.black=!this.black,t.setStorage({key:"black",data:this.black})},back:function(){t.navigateBack({delta:1})},gotoxslist:function(){t.navigateTo({url:"/pages/xslist/xslist?xsname="+encodeURIComponent(this.xsname)+"&num="+encodeURIComponent(this.num)+"&from=xs&url="+this.url1+"&cover="+this.cover})},scrollClick:function(){this.show=!this.show,this.getBattery(),this.show?plus.navigator.setFullscreen(!1):plus.navigator.setFullscreen(!0)},getScrollTopTotal:function(){var e=this,n=t.createSelectorQuery();n.selectAll(".m-item").boundingClientRect(),n.select("#scrollview").boundingClientRect(),n.exec(function(t){e.style.mitemHeight=0,t[0].forEach(function(t){return e.style.mitemHeight=e.style.mitemHeight+t.height}),setTimeout(function(){e.scrollTopTotal=e.style.mitemHeight-e.style.contentViewHeight},100)})},getTIme:function(){var t=new Date,e=t.getHours(),n=t.getMinutes();e=e<=9?"0"+e:e,n=n<=9?"0"+n:n,this.time=e+":"+n},getBattery:function(){var t=this;t.getTIme();var e=t.UIDevice.currentDevice();e.isBatteryMonitoringEnabled()||e.setBatteryMonitoringEnabled(!0);var n=e.batteryLevel();t.level=n<=1&&n>=0?Math.round(100*n):Math.round(n)},getCacheState:function(e){var n=this,o=t.getStorageSync("xsDownload");if(o){for(var i=0;i<o.length;i++)if(o[i].name==n.xsname){var s=o[i].data;o[i].cover=n.cover,o[i].url=n.url1,o[i].num=n.num,o[i].xslist=e,console.log(a(n.cover," at pages/xs/xs.vue:480")),s.forEach(function(t){e.forEach(function(e){t.numName==e.num&&"done"==t.state&&(e.state="done")})});break}t.setStorageSync("xsDownload",o)}},handletouchmove:function(t){var e=this;clearTimeout(this.handletouchmoveTimer),this.handletouchmoveTimer=setTimeout(function(){var n=t.changedTouches[0].pageX,a=t.changedTouches[0].pageY,o=n-e.lastX,i=a-e.lastY,s="";Math.abs(o)>Math.abs(i)?o<-e.ditance?(s="向左滑动",e.flag=1):o>e.ditance&&(s="向右滑动",e.flag=2):i<-e.ditance?(s="向上滑动",e.flag=3,e.scrollTopTotal-e.scrollTop-40==0&&e.next()):i>e.ditance&&(s="向下滑动",e.flag=4,0==e.scrollTop&&e.prev()),e.lastX=n,e.lastY=a,e.text=s},20),clearTimeout(this.getBatteryTimer),this.getBatteryTimer=setTimeout(function(){e.getBattery()},300)},handletouchstart:function(t){this.lastX=t.changedTouches[0].pageX,this.lastY=t.changedTouches[0].pageY},handletouchend:function(t){}},onPageScroll:function(t){this.scrollTop=t.scrollTop,console.log(a(this.scrollTopTotal-this.scrollTop," at pages/xs/xs.vue:551"))},onReady:function(){var e=this;switch(t.getStorage({key:"black",success:function(t){e.black=t.data}}),this.getTIme(),t.getSystemInfoSync().platform){case"android":var n=plus.android.runtimeMainActivity(),a=plus.android.importClass("android.content.Intent"),o=plus.android.implements("io.dcloud.feature.internal.reflect.BroadcastReceiver",{onReceive:function(t,n){var o=n.getAction();if(o==a.ACTION_BATTERY_CHANGED){var i=n.getIntExtra("level",0);e.level=i<=1&&i>=0?100*Math.round(i):Math.round(i),e.getTIme()}}}),i=plus.android.importClass("android.content.IntentFilter"),s=new i(a.ACTION_BATTERY_CHANGED);n.registerReceiver(o,s);break;case"ios":e.UIDevice=plus.ios.import("UIDevice"),this.getBattery();break;default:e.battery=navigator.battery||navigator.mozBattery||navigator.webkitBattery;var l=function(t){e.level=100*e.battery.level,e.getTIme()};e.battery?e.battery.addEventListener("levelchange",l):navigator.getBattery().then(function(t){e.battery=t,e.battery.addEventListener("levelchange",l)});break}},onUnload:function(){plus.navigator.setFullscreen(!1)},onLoad:function(e){var n=this,a=this;plus.navigator.setFullscreen(!0),this.title=decodeURIComponent(e.name),this.url=decodeURIComponent(e.src),this.xsname=decodeURIComponent(e.xsname),this.cover=decodeURIComponent(e.cover),this.num=decodeURIComponent(e.num),this.url1=decodeURIComponent(e.url),a.xslist=t.getStorageSync("xslist"+this.xsname),a.reloadContent(),setTimeout(function(){t.request({url:o.default.baseUrl,data:{xsurl1:a.url1},method:"GET",complete:function(e){if(200==e.statusCode&&e.data&&0==e.data.code){var n=e.data.list;a.xslist=n,a.getCacheState(n);try{t.setStorageSync("xslist"+a.xsname,a.xslist)}catch(o){}a.reloadContent()}else t.showToast({title:"获取章节目录失败",icon:"none"})}})},100),t.setNavigationBarTitle({title:this.title}),this.$eventHub.$on("changeXsContent",function(e,a){n.title=e.num,t.setNavigationBarTitle({title:n.title}),n.num=a,n.reloadContent()})}};e.default=c}).call(this,n("6e42")["default"],n("0de9")["default"])},"6b99":function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement;t._self._c},o=[];n.d(e,"a",function(){return a}),n.d(e,"b",function(){return o})},ca9a:function(t,e,n){},d187:function(t,e,n){"use strict";n.r(e);var a=n("6b99"),o=n("5835");for(var i in o)"default"!==i&&function(t){n.d(e,t,function(){return o[t]})}(i);n("e7da");var s=n("2877"),l=Object(s["a"])(o["default"],a["a"],a["b"],!1,null,null,null);e["default"]=l.exports},e7da:function(t,e,n){"use strict";var a=n("ca9a"),o=n.n(a);o.a},feec:function(t,e,n){"use strict";(function(t){n("c9d0"),n("921b");a(n("66fd"));var e=a(n("d187"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("6e42")["createPage"])}},[["feec","common/runtime","common/vendor"]]]);