(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/download/download"],{"379e":function(t,e,n){"use strict";var o=n("e241"),a=n.n(o);a.a},"4c91":function(t,e,n){"use strict";var o={uniPopup:function(){return n.e("components/uni-popup/uni-popup").then(n.bind(null,"9463"))}},a=function(){var t=this,e=t.$createElement,n=(t._self._c,t.__map(t.tabBars,(function(e,n){var o=t.__map(e.contentList,(function(e,n){var o=t.getDownloadState(e.download),a=t.getPercent(e);return{$orig:t.__get_orig(e),m0:o,m1:a}}));return{$orig:t.__get_orig(e),l0:o}})));t.$mp.data=Object.assign({},{$root:{l1:n}})},s=[];n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return o}))},"587e":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=s(n("4795")),a=s(n("c644"));function s(t){return t&&t.__esModule?t:{default:t}}function c(t,e,n,o,a,s,c){try{var i=t[s](c),r=i.value}catch(l){return void n(l)}i.done?e(r):Promise.resolve(r).then(o,a)}function i(t){return function(){var e=this,n=arguments;return new Promise((function(o,a){var s=t.apply(e,n);function i(t){c(s,o,a,i,r,"next",t)}function r(t){c(s,o,a,i,r,"throw",t)}i(void 0)}))}}var r,l=function(){n.e("components/mix-loading/mix-loading").then(function(){return resolve(n("3075"))}.bind(null,n)).catch(n.oe)},u=function(){n.e("components/uni-icons/uni-icons").then(function(){return resolve(n("72fa"))}.bind(null,n)).catch(n.oe)},d=function(){n.e("components/uni-nav-bar/uni-nav-bar").then(function(){return resolve(n("4e45"))}.bind(null,n)).catch(n.oe)},f=function(){n.e("components/uni-popup/uni-popup").then(function(){return resolve(n("9463"))}.bind(null,n)).catch(n.oe)},h=0,g=!1,p={components:{mixLoading:l,uniIcons:u,uniNavBar:d,uniPopup:f},data:function(){return{tabBars:[{name:"影视",id:"3",contentList:[]},{name:"漫画",id:"1",contentList:[]}],tabCurrentIndex:0,scrollLeft:0,enableScroll:!0,contentData:{},loading:!1,keyWord:"",timedown:3,loadListRequest:null,cancelFlag:!1,show:!1,type:"",selectObj:"",selectObjIndex:0}},onHide:function(){this.$refs["share"].close(),this.cancelFlag=!1},computed:{},onNavigationBarButtonTap:function(t){t.index,1==t.index&&this.clearCache()},onShow:function(){this.loadList(),t.request({url:"https://www.gjtool.cn/download/config.json",method:"GET",complete:function(e){if(200==e.statusCode&&e.data){var n=e.data;t.setStorage({key:"config",data:n}),n&&n.enable||t.reLaunch({url:"/pages/gonggao/gonggao"})}}})},onLoad:function(){var e=this;return i(o.default.mark((function n(){var a;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:a=e,h=t.getSystemInfoSync().windowWidth,e.$eventHub.$on("xsDownload",(function(e){var n=t.getStorageSync("xsDownload");if(n){for(var o=0;o<n.length;o++)if(n[o].name==e.name){n[o].cache=!0,n[o].download="2",a.downloadxsAll(n[o]);break}a.tabBars[1].contentList=n,t.setStorageSync("xsDownload",n)}})),e.$eventHub.$on("ysDownload",(function(t){})),e.$eventHub.$on("mhDownload",(function(t){})),setTimeout((function(){for(var e=a.tabBars[1].contentList,n=0;n<e.length;n++)"1"!=e[n].download&&(e[n].download="3");a.tabBars[1].contentList=e,t.setStorageSync("xsDownload",e)}),300);case 6:case"end":return n.stop()}}),n)})))()},onUnload:function(){for(var e=_this.tabBars[1].contentList,n=0;n<e.length;n++)e[n].download="3";_this.tabBars[1].contentList=e,t.setStorageSync("xsDownload",e)},onReady:function(){},methods:{clearCache:function(){t.showModal({title:"提示",content:"确定清除所有缓存吗？",success:function(e){if(e.confirm)try{t.clearStorage(),t.showToast({title:"清除成功",icon:"none"})}catch(n){}}})},downloadxsAll:function(t){if(t.cache){t.xslist,t.data;this.getData(0,t)}},isDownload:function(t,e){for(var n=!1,o=0;o<e.length;o++)if(e[o].num==t&&(e[o].list.length||"done"==e[o].state)){n=!0;break}return n},getNoDownload:function(t,e){return this.isDownload(t,e)?(t++,this.getNoDownload(t,e)):t},getData:function(e,n){var o=this,s=t.getStorageSync("xsDownload");if(s)for(var c=0;c<s.length;c++)if(s[c].name==n.name){n=s[c];break}var i=this.getNoDownload(e,n.data);if(e=i,e>=n.xslist.length){for(var r=o.tabBars[1].contentList,l=0;l<r.length;l++)r[l].name==n.name&&(r[l].download="1");return o.tabBars[1].contentList=r,t.setStorageSync("xsDownload",r),void(o.selectObj.downloadText="继续")}"3"!=n.download&&t.request({url:a.default.baseUrl,data:{xsurl2:n.xslist[e].url},method:"GET",complete:function(t){if(200==t.statusCode&&t.data&&0==t.data.code){var a=t.data.content;o.setCacheValue(e,a,"done",n,(function(){e++,o.getData(e,n)}))}else o.setCacheValue(e,[],"fail",n,(function(){o.getData(e,n)}))}})},setCacheValue:function(e,n,o,a,s){var c=this,i=a.xslist;e=parseInt(e);var r={name:a.name,cover:a.cover,url:a.url,num:a.num,cache:!1,download:"0",xslist:i,data:[]};e>=i.length-1?r.download="1":r.download="2";var l={numName:i[e].num,numUrl:i[e].url,num:e,list:n,state:o};r.data.push(l);var u=t.getStorageSync("xsDownload"),d=!1;if(u){for(var f=0;f<u.length;f++)if(u[f].name==a.name){var h=u[f].data;u[f].cover=a.cover,u[f].url=a.url,u[f].num=a.num;for(var g=!1,p=0;p<h.length;p++)h[p].numName==i[e].num&&h[p].num==e&&(h[p].list=n,h[p].numUrl=i[e].url,h[p].state="done",g=!0);g||(u[f].xslist=i,u[f].data.push(l)),d=!0;break}d||u.push(r)}else u=[],u.push(r);c.tabBars[1].contentList=u,t.setStorageSync("xsDownload",u),s&&s()},gotoXsJianjie:function(){var e=this.selectObj;if("3"==this.selectType&&t.navigateTo({url:"/pages/details/details?data=".concat(JSON.stringify(e))}),"1"==this.selectType&&t.navigateTo({url:"/pages/details/mhdetails?data=".concat(JSON.stringify(e))}),"2"==this.selectType){var n={cover:e.cover,name:e.name,num:e.num,url:e.url};t.navigateTo({url:"/pages/details/xsdetails?data=".concat(JSON.stringify(n))})}},gotoXsMulu:function(){var e=this.selectObj;this.selectType,this.selectType,"2"==this.selectType&&t.navigateTo({url:"/pages/xslist/xslist?xsname="+encodeURIComponent(e.name)+"&num="+encodeURIComponent(e.num)+"&from=download&url="+e.url+"&cover="+e.cover})},downloadXs:function(){var e=this,n=this.selectObj;if(this.$refs["share"].close(),this.selectType,this.selectType,"2"==this.selectType){var o=t.getStorageSync("xsDownload"),a={};if(o){for(var s=0;s<o.length;s++)if(o[s].name==n.name){o[s].cache=!0,"2"!=o[s].download?(o[s].download="2",a=o[s],e.selectObj.downloadText="暂停"):(o[s].download="3",e.selectObj.downloadText="继续");break}e.tabBars[1].contentList=o,t.setStorageSync("xsDownload",o),a&&a.download&&"2"==a.download&&e.downloadxsAll(a)}}},deleteXsSc:function(){var e=this,n=this;this.$refs["share"].close();var o=this.selectObj;t.showModal({title:"提示",content:"确定删除《"+o.name+"》吗？",success:function(a){if(a.confirm){if(e.selectType,e.selectType,"2"==e.selectType){var s=t.getStorageSync("xsDownload"),c=!1;if(s&&s.length){for(var i=0;i<s.length;i++)if(s[i].name==o.name){c=!0,s[i].cache=!1,s.splice(i,1);break}n.tabBars[1].contentList=s,t.setStorageSync("xsDownload",s)}setTimeout((function(){c?t.showToast({title:"删除成功"}):t.showToast({title:"删除失败",icon:"none"})}),100)}}else a.cancel}})},longpress:function(t,e,n){this.selectObj=t,this.selectObjIndex=e,"3"==t.download||"1"==t.download?this.selectObj.downloadText="继续":this.selectObj.downloadText="暂停",this.cancelFlag=!1,this.selectType=n,"2"==this.selectType&&this.togglePopup("bottom","share")},togglePopup:function(t,e){switch(t){case"top":this.content="顶部弹出 popup";break;case"bottom":this.content="底部弹出 popup";break;case"center":this.content="居中弹出 popup";break}this.type=t,"tip"===e?this.show=!0:this.$refs[e].open()},cancel:function(t){"tip"!==t?this.$refs[t].close():this.show=!1},change:function(t){},loadList:function(){var e=this;t.getStorage({key:"xsDownload",success:function(t){e.tabBars[1].contentList=t.data}}),t.getStorage({key:"ysDownload",success:function(t){e.tabBars[0].contentList=t.data}}),t.getStorage({key:"mhDownload",success:function(t){e.tabBars[2].contentList=t.data}})},getPercent:function(t){var e=t.data.length,n=t.xslist.length;return(e/n*100).toFixed(2)},getDownloadState:function(t){var e="";switch(t){case"1":e="下载完毕";break;case"2":e="正在下载";break;case"3":default:e="下载暂停";break}return e},imgError:function(t){t.cover="/static/movie.png"},setEnableScroll:function(t){this.enableScroll!==t&&(this.enableScroll=t)},changeTab:function(t){var e=this;return i(o.default.mark((function n(){var a,s,c,i,l;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.loading=!1,g&&(clearTimeout(g),g=!1),a=t,"object"===typeof t&&(a=t.detail.current),"object"===typeof r){n.next=8;break}return n.next=7,e.getElSize("nav-bar");case 7:r=n.sent;case 8:r.scrollLeft,s=0,c=0,i=0;case 12:if(!(i<=a)){n.next=21;break}return n.next=15,e.getElSize("tab"+i);case 15:l=n.sent,s+=l.width,i===a&&(c=l.width);case 18:i++,n.next=12;break;case 21:"number"===typeof t&&(e.tabCurrentIndex=a),g=setTimeout((function(){e.scrollLeft=s-c/2>h/2?s-c/2-h/2:0,"object"===typeof t&&(e.tabCurrentIndex=a),e.tabCurrentIndex=a;e.tabBars[e.tabCurrentIndex]}),300);case 23:case"end":return n.stop()}}),n)})))()},getElSize:function(e){return new Promise((function(n,o){var a=t.createSelectorQuery().select("#"+e);a.fields({size:!0,scrollOffset:!0,rect:!0},(function(t){n(t)})).exec()}))}}};e.default=p}).call(this,n("543d")["default"])},a90d:function(t,e,n){"use strict";n.r(e);var o=n("4c91"),a=n("ce6b");for(var s in a)"default"!==s&&function(t){n.d(e,t,(function(){return a[t]}))}(s);n("379e");var c,i=n("f0c5"),r=Object(i["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],c);e["default"]=r.exports},ce6b:function(t,e,n){"use strict";n.r(e);var o=n("587e"),a=n.n(o);for(var s in o)"default"!==s&&function(t){n.d(e,t,(function(){return o[t]}))}(s);e["default"]=a.a},e241:function(t,e,n){},ea54:function(t,e,n){"use strict";(function(t){n("2d68");o(n("66fd"));var e=o(n("a90d"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])}},[["ea54","common/runtime","common/vendor"]]]);