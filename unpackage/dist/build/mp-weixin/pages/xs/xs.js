(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/xs/xs"],{"0143":function(t,e,n){"use strict";n.r(e);var a=n("c2b0"),i=n.n(a);for(var o in a)"default"!==o&&function(t){n.d(e,t,(function(){return a[t]}))}(o);e["default"]=i.a},"08a4":function(t,e,n){"use strict";(function(t){n("2d68");a(n("66fd"));var e=a(n("cbed"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},"17b3":function(t,e,n){},"34a5":function(t,e,n){"use strict";var a=n("17b3"),i=n.n(a);i.a},"847a":function(t,e,n){"use strict";var a={battery:function(){return n.e("components/battery/battery").then(n.bind(null,"5aa6"))}},i=function(){var t=this,e=t.$createElement,n=(t._self._c,t.__map(t.pageList,(function(e,n){var a=parseInt(e.id);return{$orig:t.__get_orig(e),m0:a}})));t.$mp.data=Object.assign({},{$root:{l0:n}})},o=[];n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return a}))},c2b0:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i(n("c644"));function i(t){return t&&t.__esModule?t:{default:t}}var o=function(){n.e("components/mix-loading/mix-loading").then(function(){return resolve(n("3075"))}.bind(null,n)).catch(n.oe)},s=function(){n.e("components/uni-icons/uni-icons").then(function(){return resolve(n("72fa"))}.bind(null,n)).catch(n.oe)},l=function(){n.e("components/uni-nav-bar/uni-nav-bar").then(function(){return resolve(n("4e45"))}.bind(null,n)).catch(n.oe)},r=function(){n.e("components/battery/battery").then(function(){return resolve(n("5aa6"))}.bind(null,n)).catch(n.oe)},u={components:{mixLoading:o,uniIcons:s,uniNavBar:l,battery:r},data:function(){return{mode:!1,black:!1,num:0,xsname:"",show:!1,visible:!1,loading:!0,title:"",url:"",url1:"",xslist:[],list:[],scrollTop:0,prevTimer:null,nextTimer:null,xsurl2Request:null,scrollTimer:null,scrollTopTotal:0,style:{pageHeight:0,contentViewHeight:0,footViewHeight:0,mitemHeight:0},platform:"",main:null,Intent:null,IntentFilter:null,UIDevice:null,battery:{},level:100,time:"00:00",getBatteryTimer:null,load5limitCache:!0,flag:0,text:"",lastX:0,lastY:0,ditance:120,cover:"",currentIndex:0,pageList:[],windowWidth:0,windowHeight:0,pageIndex:0,currentWebview:null}},computed:{itemshow:function(){return!!(this.list&&this.list.length>0)}},created:function(){var e=t.getSystemInfoSync();this.style.pageHeight=e.windowHeight,this.style.contentViewHeight=e.windowHeight-e.screenWidth/750*100-70,this.windowWidth=e.windowWidth,this.windowHeight=e.windowHeight,this.platform=t.getSystemInfoSync().platform},methods:{changePage:function(t){var e=t.detail.current;this.pageIndex=e},prev:function(){var e=this,n=this;n.num<=0?t.showToast({title:"已经是第一章了",icon:"none"}):(clearTimeout(this.prevTimer),this.prevTimer=setTimeout((function(){e.num--,n.num<=-1&&(n.num=0),e.reloadContent()}),300))},next:function(){var e=this,n=this;n.num>=this.xslist.length-1?t.showToast({title:"已经是最后一章了",icon:"none"}):(clearTimeout(this.nextTimer),this.xsurl2Request&&this.xsurl2Request.abort(),this.nextTimer=setTimeout((function(){n.num++,n.num>=e.xslist.length&&(n.num=e.xslist.length-1),e.reloadContent()}),300))},reloadContent:function(){var e=this,n=this,i=this.num;i=parseInt(i),t.setStorage({key:"xsNum"+n.xsname,data:i});try{var o=t.getStorageSync("xsShouCang");if(o){for(var s=0;s<o.length;s++)if(o[s].name==n.xsname){o[s].num=i,!0;break}t.setStorage({key:"xsShouCang",data:o})}}catch(m){}if(this.xslist.length){var l=this.xslist;n.title=l[i].num,n.list=[];var r=t.getStorageSync("xsDownload"),u=!1;if(r)for(var c=0;c<r.length;c++)if(r[c].name==n.xsname){for(var h=r[c].data,d=0;d<h.length;d++)if((h[d].num||0==h[d].num)&&h[d].num==i&&h[d].list.length){n.list=h[d].list,setTimeout((function(){t.pageScrollTo({scrollTop:0,duration:0})}),0),u=!0;break}break}if(u)return n.loading=!1,void setTimeout((function(){e.getScrollTopTotal(),e.load5limit()}),300);n.loading=!0,n.setCacheValue(i,[],"loading"),n.xsurl2Request=t.request({url:a.default.baseUrl,data:{xsurl2:l[i].url},method:"GET",complete:function(a){200==a.statusCode&&a.data&&0==a.data.code?(n.list=a.data.content,n.setCacheValue(i,n.list,"done"),setTimeout((function(){e.getScrollTopTotal(),e.load5limit()}),300)):(setTimeout((function(){e.getScrollTopTotal()}),300),n.setCacheValue(i,[],"fail"),t.showToast({title:"获取第"+i+"章内容失败",icon:"none"})),n.loading=!1}})}},load5limit:function(){if(this.load5limitCache){var t=this.num;t=parseInt(t);this.xslist;this.loadCache(t+1),this.loadCache(t+2),this.loadCache(t+3),this.loadCache(t+4),this.loadCache(t+5)}},loadCache:function(e){var n=this.xslist;if(!(e>=n.length)){var a=this,i=t.getStorageSync("xsDownload");a.xslist;e=parseInt(e);var o=!1;if(i)for(var s=0;s<i.length;s++)if(i[s].name==a.xsname){for(var l=i[s].data,r=0;r<l.length;r++)if(l[r].num&&l[r].num==e&&(l[r].list.length||"loading"==l[r].state)){o=!0;break}break}o||(a.setCacheValue(e,[],"loading"),a.getData(e))}},getData:function(e){var n=this,i=this.xslist;e=parseInt(e);var o=i[e].url;t.request({url:a.default.baseUrl,data:{xsurl2:o},method:"GET",complete:function(t){if(n.loading=!1,200==t.statusCode&&t.data&&0==t.data.code){var a=t.data.content;n.setCacheValue(e,a,"done")}else n.setCacheValue(e,[],"fail")}})},setCacheValue:function(e,n,a){var i=this,o=this.xslist;e=parseInt(e);var s={name:i.xsname,cover:i.cover,url:this.url1,num:this.num,cache:!1,download:"0",xslist:o,data:[]},l={numName:o[e].num,numUrl:o[e].url,num:e,list:n,state:a};s.data.push(l);var r=t.getStorageSync("xsDownload"),u=!1;if(r){for(var c=0;c<r.length;c++)if(r[c].name==i.xsname){var h=r[c].data;r[c].cover=i.cover,r[c].url=i.url1,r[c].num=i.num;for(var d=!1,m=0;m<h.length;m++)h[m].numName==o[e].num&&h[m].num==e&&(h[m].list=n,h[m].numUrl=o[e].url,h[m].state=a,d=!0);d||(r[c].xslist=o,r[c].data.push(l)),u=!0;break}u||r.push(s)}else r=[],r.push(s);t.setStorageSync("xsDownload",r)},download:function(){t.showToast({title:"点击了下载"})},changeBg:function(){this.black=!this.black,t.setStorage({key:"black",data:this.black})},back:function(){t.navigateBack({delta:1})},shuaxin:function(){this.loading=!0,this.getData(this.num)},setmode:function(){this.mode=!this.mode},gotoxslist:function(){t.navigateTo({url:"/pages/xslist/xslist?xsname="+encodeURIComponent(this.xsname)+"&num="+encodeURIComponent(this.num)+"&from=xs&url="+this.url1+"&cover="+this.cover})},scrollClick:function(){this.show=!this.show},getScrollTopTotal:function(){var e=this,n=this,a=t.createSelectorQuery();a.selectAll(".m-item").boundingClientRect(),a.exec((function(t){n.style.mitemHeight=0,t[0].forEach((function(t,e){n.style.mitemHeight=n.style.mitemHeight+t.height})),setTimeout((function(){n.scrollTopTotal=n.style.mitemHeight-n.style.contentViewHeight}),0),n.pageList=[],n.pageIndex=0,n.currentIndex=0;var a=Math.ceil(e.style.mitemHeight/e.style.contentViewHeight);setTimeout((function(){var i=[],o=0,s={};t[0].forEach((function(t,n){o+=t.height;for(var i=1;i<=a;i++)o>=i*e.style.contentViewHeight-20&&(s[i-1]||(s[i-1]=n))}));for(var l=0;l<a;l++){var r={};r.id=l,r.contentList=0==l?n.list.slice(0,s[l]):l==a-1?n.list.slice(s[l-1],n.list.lenght):n.list.slice(s[l-1],s[l]),i.push(r)}n.currentIndex=0,n.pageList=i}),0)}))},getTIme:function(){var t=new Date,e=t.getHours(),n=t.getMinutes();e=e<=9?"0"+e:e,n=n<=9?"0"+n:n,this.time=e+":"+n},getBattery:function(){var t=this;t.getTIme()},getCacheState:function(e){var n=this,a=t.getStorageSync("xsDownload");if(a){for(var i=0;i<a.length;i++)if(a[i].name==n.xsname){var o=a[i].data;a[i].cover=n.cover,a[i].url=n.url1,a[i].num=n.num,a[i].xslist=e,o.forEach((function(t){e.forEach((function(e){t.numName==e.num&&"done"==t.state&&(e.state="done")}))}));break}t.setStorageSync("xsDownload",a)}},handletouchmove:function(t){var e=this;clearTimeout(this.handletouchmoveTimer),this.handletouchmoveTimer=setTimeout((function(){var n=t.changedTouches[0].pageX,a=t.changedTouches[0].pageY,i=n-e.lastX,o=a-e.lastY,s="";Math.abs(i)>Math.abs(o)?e.mode&&(i<-e.ditance?(s="向左滑动",e.flag=1,e.pageIndex==e.pageList.length-1&&(e.currentIndex=0,e.next())):i>e.ditance&&(s="向右滑动",e.flag=2,0==e.pageIndex&&(e.currentIndex=0,e.prev()))):e.mode||(o<-e.ditance?(s="向上滑动",e.flag=3,e.scrollTopTotal-e.scrollTop-40==0&&e.next()):o>e.ditance&&(s="向下滑动",e.flag=4,0==e.scrollTop&&e.prev())),e.lastX=n,e.lastY=a,e.text=s}),20),clearTimeout(this.getBatteryTimer),this.getBatteryTimer=setTimeout((function(){e.getBattery()}),300)},handletouchstart:function(t){this.lastX=t.changedTouches[0].pageX,this.lastY=t.changedTouches[0].pageY},handletouchend:function(t){}},onPageScroll:function(t){this.scrollTop=t.scrollTop,console.log("onPageScroll-------",t.scrollTop)},onReady:function(){var e=this;t.getStorage({key:"black",success:function(t){e.black=t.data}}),this.getTIme()},onUnload:function(){},onLoad:function(e){var n=this,i=this;this.title=decodeURIComponent(e.name),this.url=decodeURIComponent(e.src),this.xsname=decodeURIComponent(e.xsname),this.cover=decodeURIComponent(e.cover),this.num=decodeURIComponent(e.num),this.url1=decodeURIComponent(e.url),i.xslist=t.getStorageSync("xslist"+this.xsname),i.reloadContent(),setTimeout((function(){t.request({url:a.default.baseUrl,data:{xsurl1:i.url1},method:"GET",complete:function(e){if(200==e.statusCode&&e.data&&0==e.data.code){var n=e.data.list;i.xslist=n,i.getCacheState(n);try{t.setStorageSync("xslist"+i.xsname,i.xslist)}catch(a){}}else t.showToast({title:"获取章节目录失败",icon:"none"})}})}),100),t.setNavigationBarTitle({title:this.title}),this.$eventHub.$on("changeXsContent",(function(e,a){n.title=e.num,t.setNavigationBarTitle({title:n.title}),n.num=a,n.reloadContent()}))}};e.default=u}).call(this,n("543d")["default"])},cbed:function(t,e,n){"use strict";n.r(e);var a=n("847a"),i=n("0143");for(var o in i)"default"!==o&&function(t){n.d(e,t,(function(){return i[t]}))}(o);n("34a5");var s,l=n("f0c5"),r=Object(l["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],s);e["default"]=r.exports}},[["08a4","common/runtime","common/vendor"]]]);